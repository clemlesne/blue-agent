<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Blue Agent – Introduction</title><link>https://clemlesne.github.io/blue-agent/docs/</link><description>Recent content in Introduction on Blue Agent</description><generator>Hugo -- gohugo.io</generator><language>en</language><atom:link href="https://clemlesne.github.io/blue-agent/docs/index.xml" rel="self" type="application/rss+xml"/><item><title>Getting started</title><link>https://clemlesne.github.io/blue-agent/docs/getting-started/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/getting-started/</guid><description>
&lt;h2>Usage&lt;span class="hx-absolute -hx-mt-20" id="usage">&lt;/span>
&lt;a href="#usage" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]">
&lt;h3>Prepare the Azure DevOps organization&lt;span class="hx-absolute -hx-mt-20" id="prepare-the-azure-devops-organization">&lt;/span>
&lt;a href="#prepare-the-azure-devops-organization" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Create &lt;a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/pools-queues" target="_blank" rel="noopener">a new agent pool&lt;/a> in Azure DevOps. Then, create &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/personal-access-token-agent-registration?view=azure-devops" target="_blank" rel="noopener">the personal access token&lt;/a>, with the scope &lt;code>agent pools (read &amp;amp; manage)&lt;/code>, allowing access from the agent to Azure DevOps.&lt;/p>
&lt;h3>Deploy&lt;span class="hx-absolute -hx-mt-20" id="deploy">&lt;/span>
&lt;a href="#deploy" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Software can either be deployed using Helm on a Kubernetes cluster or Bicep on Azure Container Apps.&lt;/p>
&lt;/div>
&lt;h2>Deploy on Azure&lt;span class="hx-absolute -hx-mt-20" id="deploy-on-azure">&lt;/span>
&lt;a href="#deploy-on-azure" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-blue-200 hx-bg-blue-100 hx-text-blue-900 dark:hx-border-blue-200/30 dark:hx-bg-blue-900/30 dark:hx-text-blue-200">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;div class="hx-select-none hx-text-xl" style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">ℹ️&lt;/div>&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">&lt;p>Azure deployment has a limitation regarding the demands and the OS:&lt;/p>
&lt;ul>
&lt;li>OS are limited to Linux, such as Debian, as Azure Containers Apps does not support Windows.&lt;/li>
&lt;li>The agent will not be able to run jobs requiring a system demand, such as &lt;code>Agent.OS&lt;/code> or &lt;code>Agent.OSArchitecture&lt;/code>. However, user-defined demands from the &lt;code>pipelinesCapabilities&lt;/code> parameter are usable.&lt;/li>
&lt;/ul>&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>Deployment is using Bicep as a template language. Minimal configuration is required:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az deployment sub create &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --location westeurope &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name blue-agent &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --parameters &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="nv">pipelinesOrganizationURL&lt;/span>&lt;span class="o">=&lt;/span>https://dev.azure.com/your-organization &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="nv">pipelinesPersonalAccessToken&lt;/span>&lt;span class="o">=&lt;/span>your-pat &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="nv">pipelinesPoolName&lt;/span>&lt;span class="o">=&lt;/span>your-pool &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --template-file src/bicep/main.bicep&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>The deployment will manage the resource provisioning, in a dedicated resource group. This includes (but is not limited to) Container Apps and Log Analytics.&lt;/p>
&lt;p>Details about the Helm configuration &lt;a href="../advanced-topics/bicep-deployment" >can be found in a dedicated section&lt;/a>.&lt;/p>
&lt;h2>Deploy on Kubernetes&lt;span class="hx-absolute -hx-mt-20" id="deploy-on-kubernetes">&lt;/span>
&lt;a href="#deploy-on-kubernetes" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;div class="steps hx-ml-4 hx-mb-12 ltr:hx-border-l rtl:hx-border-r hx-border-gray-200 ltr:hx-pl-6 rtl:hx-pr-6 dark:hx-border-neutral-800 [counter-reset:step]">
&lt;h3>Prepare the Helm values&lt;span class="hx-absolute -hx-mt-20" id="prepare-the-helm-values">&lt;/span>
&lt;a href="#prepare-the-helm-values" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Minimal configuration is required:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">pipelines&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">organizationURL&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://dev.azure.com/your-organization&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">personalAccessToken&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">your-pat&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">poolName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">your-pool&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Details about the Helm configuration &lt;a href="../advanced-topics/helm-values" >can be found in a dedicated section&lt;/a>.&lt;/p>
&lt;h3>Install the chart&lt;span class="hx-absolute -hx-mt-20" id="install-the-chart">&lt;/span>
&lt;a href="#install-the-chart" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Use Helm to install the latest released chart:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">helm repo add clemlesne-blue-agent https://clemlesne.github.io/blue-agent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">helm repo update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">helm upgrade --install agent clemlesne-blue-agent/blue-agent&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;h2>OS support matrix&lt;span class="hx-absolute -hx-mt-20" id="os-support-matrix">&lt;/span>
&lt;a href="#os-support-matrix" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>OS support is generally called &amp;ldquo;flavor&amp;rdquo; in this documentation. The following table shows the supported flavors and their characteristics.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;code>Ref&lt;/code>&lt;/th>
&lt;th>OS&lt;/th>
&lt;th>&lt;code>Size&lt;/code>&lt;/th>
&lt;th>&lt;code>Arch&lt;/code>&lt;/th>
&lt;th>Support&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:azurelinux3-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://github.com/microsoft/azurelinux" target="_blank" rel="noopener">Azure Linux 3&lt;/a>&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/azurelinux3-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>, &lt;code>arm64/v8&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://learn.microsoft.com/en-us/azure/aks/support-policies" target="_blank" rel="noopener">See Microsoft Azure documentation.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:bookworm-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://www.debian.org/releases/bookworm" target="_blank" rel="noopener">Debian Bookworm (12)&lt;/a> slim&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/bookworm-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>, &lt;code>arm64/v8&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://wiki.debian.org/LTS" target="_blank" rel="noopener">See Debian LTS wiki.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:noble-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://www.releases.ubuntu.com/noble" target="_blank" rel="noopener">Ubuntu Noble (24.04)&lt;/a> minimal&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/noble-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://wiki.ubuntu.com/Releases" target="_blank" rel="noopener">See Ubuntu LTS wiki.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:jammy-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://www.releases.ubuntu.com/jammy" target="_blank" rel="noopener">Ubuntu Jammy (22.04)&lt;/a> minimal&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/jammy-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>, &lt;code>arm64/v8&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://wiki.ubuntu.com/Releases" target="_blank" rel="noopener">See Ubuntu LTS wiki.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:ubi9-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://developers.redhat.com/articles/ubi-faq" target="_blank" rel="noopener">Red Hat UBI 9&lt;/a> minimal&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/ubi9-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>, &lt;code>arm64/v8&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://access.redhat.com/product-life-cycles/?product=Red%20Hat%20Enterprise%20Linux" target="_blank" rel="noopener">See Red Hat product life cycles.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:ubi8-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://developers.redhat.com/articles/ubi-faq" target="_blank" rel="noopener">Red Hat UBI 8&lt;/a> minimal&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/ubi8-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>, &lt;code>arm64/v8&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://access.redhat.com/product-life-cycles/?product=Red%20Hat%20Enterprise%20Linux" target="_blank" rel="noopener">See Red Hat product life cycles.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:win-ltsc2022-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://learn.microsoft.com/en-us/windows-server" target="_blank" rel="noopener">Windows Server 2022&lt;/a> Core&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/win-ltsc2022-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://learn.microsoft.com/en-us/virtualization/windowscontainers/deploy-containers/base-image-lifecycle" target="_blank" rel="noopener">See base image servicing lifecycles.&lt;/a>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:win-ltsc2019-main&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://learn.microsoft.com/en-us/windows-server" target="_blank" rel="noopener">Windows Server 2019&lt;/a> Core&lt;/td>
&lt;td>&lt;img src="https://img.shields.io/docker/image-size/clemlesne/blue-agent/win-ltsc2019-main?label=" alt="Docker Image Size (tag)" loading="lazy" />&lt;/td>
&lt;td>&lt;code>amd64&lt;/code>&lt;/td>
&lt;td>&lt;a href="https://learn.microsoft.com/en-us/virtualization/windowscontainers/deploy-containers/base-image-lifecycle" target="_blank" rel="noopener">See base image servicing lifecycles.&lt;/a>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2>Docker Hub images&lt;span class="hx-absolute -hx-mt-20" id="docker-hub-images">&lt;/span>
&lt;a href="#docker-hub-images" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Container images are both published to GitHub Container Registry and Docker Hub. URLs showed in the doc are GitHub Container Registry URLs, for simplicity. To use Docker Hub, replace &lt;code>ghcr.io/clemlesne/blue-agent&lt;/code> by &lt;code>docker.io/clemlesne/blue-agent&lt;/code>. Docker Hub images are signed and secured the same way. &lt;a href="https://hub.docker.com/r/clemlesne/blue-agent" target="_blank" rel="noopener">See the images at hub.docker.com.&lt;/a>&lt;/p></description></item><item><title>Quality assurance</title><link>https://clemlesne.github.io/blue-agent/docs/quality/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/quality/</guid><description>
&lt;h2>Version control&lt;span class="hx-absolute -hx-mt-20" id="version-control">&lt;/span>
&lt;a href="#version-control" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Git flow is used for version control. The main branch is &lt;code>main&lt;/code> and the development branch is &lt;code>develop&lt;/code>. Feature branches are created from &lt;code>develop&lt;/code> and merged back into &lt;code>develop&lt;/code> when the feature is complete. When a release is ready, &lt;code>develop&lt;/code> is merged into &lt;code>main&lt;/code> and a tag is created.&lt;/p>
&lt;p>Version number is compliant to &lt;a href="https://semver.org/" target="_blank" rel="noopener">Semantic Versioning&lt;/a> and dynamically generated by &lt;a href="https://github.com/clemlesne/gitops-version" target="_blank" rel="noopener">gitops-version&lt;/a>.&lt;/p>
&lt;pre class="mermaid hx-mt-6">
gitGraph
commit
branch develop
branch &amp;#34;feat/feature1&amp;#34;
commit
commit
checkout develop
merge &amp;#34;feat/feature1&amp;#34; tag: &amp;#34;v0.1.0&amp;#34;
checkout develop
branch &amp;#34;feat/feature2&amp;#34;
commit
checkout develop
branch &amp;#34;feat/feature3&amp;#34;
commit
checkout &amp;#34;feat/feature2&amp;#34;
commit
checkout develop
merge &amp;#34;feat/feature2&amp;#34; tag: &amp;#34;v0.2.0&amp;#34;
checkout &amp;#34;feat/feature3&amp;#34;
commit
checkout develop
merge &amp;#34;feat/feature3&amp;#34; tag: &amp;#34;v0.2.1&amp;#34;
checkout main
merge develop
&lt;/pre>&lt;h2>Functional tests&lt;span class="hx-absolute -hx-mt-20" id="functional-tests">&lt;/span>
&lt;a href="#functional-tests" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Functional tests are run on every pull request and on every commit to &lt;code>develop&lt;/code> and &lt;code>main&lt;/code> branches. Azure DevOps is contacted to validate each pipeline run.&lt;/p>
&lt;pre class="mermaid hx-mt-6">
sequenceDiagram
participant cicd as GitHub Actions
participant func as Functional tests
participant azure as Azure IacC
participant agent as Agent
participant azdo as Azure DevOps
loop Every flavor
cicd -&amp;gt;&amp;gt; func: Run functional tests
func -&amp;gt;&amp;gt; azure: Deploy to Azure
azure -&amp;gt;&amp;gt; azure: Process Bicep file
func -&amp;gt;&amp;gt; azure: Validate deployment
loop Every pipeline file
func -&amp;gt;&amp;gt; azure: Manual job start
azure -&amp;gt;&amp;gt; agent: Initialize
activate agent
agent -&amp;gt;&amp;gt; azdo: Registers to the pool
func -&amp;gt;&amp;gt; azdo: Create &amp;amp; run a mock pipeline
agent -&amp;gt;&amp;gt; agent: Execute the pipeline
agent -&amp;gt;&amp;gt; azdo: Send result
deactivate agent
func -&amp;gt;&amp;gt; azdo: Validate pipeline
end
func -&amp;gt;&amp;gt; cicd: Success
end
&lt;/pre></description></item><item><title>Security</title><link>https://clemlesne.github.io/blue-agent/docs/security/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/security/</guid><description>
&lt;h2>Proactive detection of vulnerabilities&lt;span class="hx-absolute -hx-mt-20" id="proactive-detection-of-vulnerabilities">&lt;/span>
&lt;a href="#proactive-detection-of-vulnerabilities" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>At each build, a vulnerability scan is performed on the system. If a vulnerability that can be upgraded is detected, the build is stopped and the image is not pushed to the registry. Vulnerability is reported in &lt;a href="https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/about-code-scanning" target="_blank" rel="noopener">GitHub Security&lt;/a>. The maintainers are alterted and have access to reports.&lt;/p>
&lt;p>Automation is supported by &lt;a href="https://snyk.io" target="_blank" rel="noopener">Snyk&lt;/a> and &lt;a href="https://semgrep.dev" target="_blank" rel="noopener">Semgrep&lt;/a>. Helm chart, configuration files, and containers, are scanned for vulnerabilities and misconfigurations.&lt;/p>
&lt;p>Scanned systems:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;code>Ref&lt;/code>&lt;/th>
&lt;th>Vulnerability scans with Snyk&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:azurelinux3-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:bookworm-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:jammy-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:noble-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:ubi8-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:ubi9-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:win-ltsc2019-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:win-ltsc2022-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2>Reporting a vulnerability&lt;span class="hx-absolute -hx-mt-20" id="reporting-a-vulnerability">&lt;/span>
&lt;a href="#reporting-a-vulnerability" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>If you think you have found a vulnerability, please do not open an issue on GitHub. Instead, please send an email to &lt;a href="mailto:clemence@lesne.pro" >Clémence Lesné&lt;/a>.&lt;/p>
&lt;h2>Chain of trust&lt;span class="hx-absolute -hx-mt-20" id="chain-of-trust">&lt;/span>
&lt;a href="#chain-of-trust" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Both the containers and the Helm chart are signed:&lt;/p>
&lt;h3>Containers&lt;span class="hx-absolute -hx-mt-20" id="containers">&lt;/span>
&lt;a href="#containers" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Containers are signed with &lt;a href="https://github.com/sigstore/cosign" target="_blank" rel="noopener">Cosign&lt;/a>.&lt;/p>
&lt;p>Cosign public key is available in &lt;a href="cosign.pub" >&lt;code>/cosign.pub&lt;/code>&lt;/a>.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example of verification with Cosign&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ cosign verify --key cosign.pub ghcr.io/clemlesne/blue-agent:bookworm-main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Verification &lt;span class="k">for&lt;/span> ghcr.io/clemlesne/blue-agent:bookworm-main --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The following checks were performed on each of these signatures:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - The cosign claims were validated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - Existence of the claims in the transparency log was verified offline
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - The signatures were verified against the specified public key&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h3>Helm chart&lt;span class="hx-absolute -hx-mt-20" id="helm-chart">&lt;/span>
&lt;a href="#helm-chart" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h3>&lt;p>Helm chart is signed with two methods, &lt;a href="https://github.com/sigstore/cosign" target="_blank" rel="noopener">Cosign&lt;/a> and &lt;a href="https://helm.sh/docs/topics/provenance" target="_blank" rel="noopener">GPG&lt;/a>. Both methods can be used to confirm authenticity of a build.&lt;/p>
&lt;p>Keys:&lt;/p>
&lt;ul>
&lt;li>Cosign public key is available in &lt;a href="cosign.pub" >&lt;code>/cosign.pub&lt;/code>&lt;/a>.&lt;/li>
&lt;li>GPG public key is &lt;a href="https://keybase.io/clemlesne/pgp_keys.asc" target="_blank" rel="noopener">available on Keybase&lt;/a> and in &lt;a href="pubring.gpg" >&lt;code>/pubring.gpg&lt;/code>&lt;/a>.&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example of verification with Helm native signature&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ helm fetch --keyring pubring.gpg --verify clemlesne-blue-agent/blue-agent --version 5.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Signed by: Clémence Lesné &amp;lt;clemence@lesne.pro&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Using Key With Fingerprint: 417E701DBC66834CA752C920460D072B9C032DFD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Chart Hash Verified: sha256:1c23e22cffc132ce12489480d139b59e97b3cb49ff1599a4ae11fb5c317c1e64&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Example of verification with Cosign&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ &lt;span class="nv">VERSION&lt;/span>&lt;span class="o">=&lt;/span>5.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ wget https://github.com/clemlesne/blue-agent/releases/download/blue-agent-&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>/blue-agent-&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>.tgz.bundle
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ helm pull clemlesne-blue-agent/blue-agent --version 5.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">❯ cosign verify-blob blue-agent-&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>.tgz --bundle blue-agent-&lt;span class="si">${&lt;/span>&lt;span class="nv">VERSION&lt;/span>&lt;span class="si">}&lt;/span>.tgz.bundle --key cosign.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Verified OK&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h2>Reliability notes&lt;span class="hx-absolute -hx-mt-20" id="reliability-notes">&lt;/span>
&lt;a href="#reliability-notes" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Systems are built every days. Each image is accompanied by a &lt;a href="https://en.wikipedia.org/wiki/Software_supply_chain" target="_blank" rel="noopener">SBOM (Software Bill of Materials)&lt;/a> which allows to verify that the installed packages are those expected. This speed has the advantage of minimizing exposure to security flaws, which will then be corrected on the build environments in 24 hours.&lt;/p>
&lt;p>Nevertheless it can happen that a package provider (e.g. Debian, Canonical, Red Hat) deploys a system update that introduces a bug. This is difficult to predict.&lt;/p>
&lt;p>Each image is pushed with a unique tag, which corresponds to the date of the last update (example: &lt;code>bookworm-20230313&lt;/code> for a build on March 13, 2023). It is therefore possible to fix the download of a version by modifying the &lt;code>image.version&lt;/code> property to &lt;code>20230313&lt;/code>.&lt;/p></description></item><item><title>Troubleshooting</title><link>https://clemlesne.github.io/blue-agent/docs/troubleshooting/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/troubleshooting/</guid><description>
&lt;h2>Pods are evicted by Kubernetes with the message &lt;code>Pod ephemeral local storage usage exceeds the total limit of containers&lt;/code>&lt;span class="hx-absolute -hx-mt-20" id="pods-are-evicted-by-kubernetes-with-the-message-pod-ephemeral-local-storage-usage-exceeds-the-total-limit-of-containers">&lt;/span>
&lt;a href="#pods-are-evicted-by-kubernetes-with-the-message-pod-ephemeral-local-storage-usage-exceeds-the-total-limit-of-containers" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>This error is due to the fact that the default ephemeral storage limit is set to a lower value than the one used by the pipeline. You can fix it by setting the value to more than default value in &lt;code>resources.limits.ephemeral-storage&lt;/code>.&lt;/p>
&lt;p>This error notably happens when using BuildKit with an &lt;code>emptyDir&lt;/code> and a large number of layers.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml (extract)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">limits&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ephemeral-storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">16Gi&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h2>Pods are started but never selected by Azure DevOps when using multiple architectures&lt;span class="hx-absolute -hx-mt-20" id="pods-are-started-but-never-selected-by-azure-devops-when-using-multiple-architectures">&lt;/span>
&lt;a href="#pods-are-started-but-never-selected-by-azure-devops-when-using-multiple-architectures" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Prefer hardcoding the architecture in both the pipeline and the Helm values. As this, KEDA will be able to select the right pods matching the architecture. Otherwise, there is a possibility that the deployment selected by KEDA is not matching the requested architecture.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># azure-pipelines.yaml (extract)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">stages&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">stage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">test&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pool&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">demands&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_x64&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml (extract)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">extraNodeSelectors&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kubernetes.io/arch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arm64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">pipelines&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">capabilities&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_arm64&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h2>Container fails to a &lt;code>ContainerStatusUnknown&lt;/code> state&lt;span class="hx-absolute -hx-mt-20" id="container-fails-to-a-containerstatusunknown-state">&lt;/span>
&lt;a href="#container-fails-to-a-containerstatusunknown-state" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>Error is often due to two things:&lt;/p>
&lt;ul>
&lt;li>Kubernetes is not able to pull the image: check the image name and the credentials, if you are using the public registry, mind the domain whitelist&lt;/li>
&lt;li>Pod has been ecivted by Kubernetes due to the excessive local storage usage: parameter &lt;code>ephemeral-storage&lt;/code> in &lt;code>resources&lt;/code> Helm values is set to &lt;code>8Gi&lt;/code> by default, you can increase it to &lt;code>16Gi&lt;/code> for example&lt;/li>
&lt;/ul>
&lt;h2>Namespaces must be set to a non-zero value&lt;span class="hx-absolute -hx-mt-20" id="namespaces-must-be-set-to-a-non-zero-value">&lt;/span>
&lt;a href="#namespaces-must-be-set-to-a-non-zero-value" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>This error is due to the fact that BuildKit needs to create a new user namespace, and the default maximum number of namespaces is 0. Value is defined by &lt;code>user.max_user_namespaces&lt;/code> (&lt;a href="https://man7.org/linux/man-pages/man7/namespaces.7.html" target="_blank" rel="noopener">documentation&lt;/a>). You can fix it by setting the value to more than 1000. Issue notably happens on AWS Bottlerocket OS. &lt;a href="https://github.com/clemlesne/blue-agent/issues/19" target="_blank" rel="noopener">See related issue.&lt;/a>&lt;/p>
&lt;p>We can update dynamically the host system settings with a DaemonSet:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># daemonset.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">DaemonSet&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app.kubernetes.io/component&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sysctl&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app.kubernetes.io/name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sysctl-max-user-ns-fix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app.kubernetes.io/part-of&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">blue-agent&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sysctl-max-user-ns-fix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app.kubernetes.io/name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sysctl-max-user-ns-fix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app.kubernetes.io/name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sysctl-max-user-ns-fix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sysctl-max-user-ns-fix&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">docker.io/library/busybox:1.36&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sh&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;-euxc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sysctl -w user.max_user_namespaces=63359 &amp;amp;&amp;amp; sleep infinity&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">securityContext&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">privileged&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h2>Change Buildkit working directory&lt;span class="hx-absolute -hx-mt-20" id="change-buildkit-working-directory">&lt;/span>
&lt;a href="#change-buildkit-working-directory" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>If need Buildkit to write in another folder, then create the buildkitd.toml file and set the root variable. Example below (bash in the pipeline):&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir ~/.config/buildkit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;root = &amp;#34;/app-root/.local/tmp/buildkit&amp;#34;&amp;#39;&lt;/span> &amp;gt; ~/.config/buildkit/buildkitd.toml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h2>The agent has exceeded the 60-minute time limit&lt;span class="hx-absolute -hx-mt-20" id="the-agent-has-exceeded-the-60-minute-time-limit">&lt;/span>
&lt;a href="#the-agent-has-exceeded-the-60-minute-time-limit" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h2>&lt;p>If the pipeline takes longer than 60 minutes, you need to change two things.&lt;/p>
&lt;ol>
&lt;li>The technical pipeline timeout with &lt;code>pipelines.timeout&lt;/code> Helm value to 7200 seconds (2 hours) for example.&lt;/li>
&lt;li>Increase the functional pipeline timeout in Azure DevOps. Go to &lt;code>Options &amp;gt; Build job &amp;gt; Build job timeout in minutes&lt;/code>.&lt;/li>
&lt;/ol>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-blue-200 hx-bg-blue-100 hx-text-blue-900 dark:hx-border-blue-200/30 dark:hx-bg-blue-900/30 dark:hx-text-blue-200">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;div class="hx-select-none hx-text-xl" style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">ℹ️&lt;/div>&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">Set a technical pipeline timeout longer than the functional pipeline timeout to avoid the system to kill the pipeline abruptly.&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>&lt;img src="build-job-timeout-in-minutes.png" alt="Configuration in the web interface." loading="lazy" />&lt;/p></description></item><item><title>0 trust</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/0-trust/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/0-trust/</guid><description>
&lt;p>By design, Blue Agent must be able to use a token to register itself to the Azure DevOps server. Centrally manage the tokens storage, their lifecycle and their access &lt;a href="https://en.wikipedia.org/wiki/Zero_trust_architecture" target="_blank" rel="noopener">greatly improve operational security&lt;/a>.&lt;/p>
&lt;h4>Kubernetes (Helm)&lt;span class="hx-absolute -hx-mt-20" id="kubernetes-helm">&lt;/span>
&lt;a href="#kubernetes-helm" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;h5>Azure Kubernetes Service&lt;span class="hx-absolute -hx-mt-20" id="azure-kubernetes-service">&lt;/span>
&lt;a href="#azure-kubernetes-service" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h5>&lt;p>Azure Kubernetes Service implements &lt;a href="https://learn.microsoft.com/en-us/azure/aks/use-azure-ad-pod-identity" target="_blank" rel="noopener">Pod Identity&lt;/a>, which allows to use a Managed Identity from a Kubernetes Pod. This will allow components on the cluster to access the secrets stored in Azure Key Vault.&lt;/p>
&lt;p>Prerequisites to the deployment are:&lt;/p>
&lt;ul>
&lt;li>The Key Vault provider for Secrets Store CSI Driver add-on &lt;a href="https://learn.microsoft.com/en-us/azure/aks/csi-secrets-store-driver" target="_blank" rel="noopener">installed in the cluster&lt;/a>.&lt;/li>
&lt;li>An Key Vault with two secrets named &lt;code>organization-url&lt;/code> and &lt;code>personal-access-token&lt;/code>, both of type &lt;code>secret&lt;/code>.&lt;/li>
&lt;li>A Managed Identity (system or user managed) with the &lt;code>Key Vault Secrets User&lt;/code> role on the Key Vault.&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">secret&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">create&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azureKeyVault&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">managedIdentityId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MY_MANAGED_IDENTITY_ID&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MY_KEY_VAULT_NAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tenantId&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">MY_TENANT_ID&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h5>Other distributions&lt;span class="hx-absolute -hx-mt-20" id="other-distributions">&lt;/span>
&lt;a href="#other-distributions" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h5>&lt;p>Disable the secret creation in the Helm chart, and integrate yourself with your own secret management solution.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">secret&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">create&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">false&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h4>Azure Container Apps (Bicep)&lt;span class="hx-absolute -hx-mt-20" id="azure-container-apps-bicep">&lt;/span>
&lt;a href="#azure-container-apps-bicep" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>Bicep is not supported out of the box. But, integration between Azure Key Vault and Azure Container Apps is native and can be done in an hour. &lt;a href="https://learn.microsoft.com/en-us/azure/container-apps/manage-secrets?tabs=azure-cli" target="_blank" rel="noopener">See the documentation.&lt;/a>&lt;/p></description></item><item><title>Build ASP.NET applications</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/build-aspnet/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/build-aspnet/</guid><description>
&lt;p>It was chosen arbitrarily to install the LTS non SDK version of ASNP.NET. Because :&lt;/p>
&lt;ul>
&lt;li>LTS is better supported by Microsoft than STS&lt;/li>
&lt;li>The non-SDK is lighter when included in a container, knowing that not everyone will use it for building purposes&lt;/li>
&lt;/ul>
&lt;p>All images are bundled with the &lt;code>8.x&lt;/code> version.&lt;/p>
&lt;p>It is recommended that development teams to hard-code the framework version you want to use, in your pipeline. With this setup, the developer controls its environment, not the platform. If they decide to upgrade, they update the pipeline, if not, not. This is under the responsibility of the developer.&lt;/p>
&lt;p>The ASP.NET framework can be installed on the fly with &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/use-dotnet-v2?view=azure-pipelines" target="_blank" rel="noopener">UseDotNet@2&lt;/a>:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># azure-pipelines.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">task&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">UseDotNet@2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">inputs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">packageType&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sdk&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">7.0.5&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Same way, if you want to use multiple versions of the framework, re-execute the task with the new version. Installations are cached locally.&lt;/p></description></item><item><title>Build container images</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/docker-in-docker/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/docker-in-docker/</guid><description>
&lt;p>These methods can be used to build a container image, at the time of writing:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Software&lt;/th>
&lt;th>Ease&lt;/th>
&lt;th>Security&lt;/th>
&lt;th>Perf&lt;/th>
&lt;th>Run location&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-tasks-overview#quick-task" target="_blank" rel="noopener">Azure Container Registry task&lt;/a>, &lt;a href="https://cloud.google.com/build/docs/building/build-containers" target="_blank" rel="noopener">Google Cloud Build&lt;/a>&lt;/td>
&lt;td>🟩🟩🟥&lt;/td>
&lt;td>🟩🟩🟩&lt;/td>
&lt;td>🟩🟩🟩&lt;/td>
&lt;td>Managed environment&lt;/td>
&lt;td>A managed service build the container image in a dedicated environment.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/GoogleContainerTools/kaniko#running-kaniko-in-a-kubernetes-cluster" target="_blank" rel="noopener">Kaniko&lt;/a>&lt;/td>
&lt;td>🟩🟥🟥&lt;/td>
&lt;td>🟩🟩🟩&lt;/td>
&lt;td>🟩🟩🟥&lt;/td>
&lt;td>Self-hosted Kubernetes&lt;/td>
&lt;td>A Pod is created for each build, taking care of building and pushing the container to the registry. No security drawbacks.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="https://github.com/genuinetools/img#running-with-kubernetes" target="_blank" rel="noopener">img&lt;/a>, &lt;a href="https://github.com/moby/buildkit" target="_blank" rel="noopener">BuildKit&lt;/a>&lt;/td>
&lt;td>🟩🟩🟩&lt;/td>
&lt;td>🟩🟩🟥&lt;/td>
&lt;td>🟩🟥🟥&lt;/td>
&lt;td>Local CLI&lt;/td>
&lt;td>CLI to build the images. Can build different architectures on a single machine. Requires &lt;a href="https://en.wikipedia.org/wiki/Seccomp" target="_blank" rel="noopener">Seccomp&lt;/a> disabled and &lt;a href="https://apparmor.net" target="_blank" rel="noopener">AppArmor&lt;/a> disabled.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Docker in docker&lt;/td>
&lt;td>🟩🟩🟩&lt;/td>
&lt;td>🟥🟥🟥&lt;/td>
&lt;td>🟩🟩🟩&lt;/td>
&lt;td>Local CLI&lt;/td>
&lt;td>Before Kubernetes 1.20, it was possible to build container images in the agent, using the Docker socket. This is not possible anymore, as Kubernetes &lt;a href="https://kubernetes.io/blog/2020/12/02/dont-panic-kubernetes-and-docker" target="_blank" rel="noopener">deprecated the Docker socket&lt;/a> in favor of the &lt;a href="https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes" target="_blank" rel="noopener">Container Runtime Interface&lt;/a>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>We choose BuildKit for this project. &lt;a href="https://raw.githubusercontent.com/moby/buildkit/v0.11.5/LICENSE" target="_blank" rel="noopener">Its license&lt;/a> allows commercial use, and the project and mainly maintained, as the time of writing, by Docker, Netlix and Microsoft.&lt;/p>
&lt;p>Linux systems are supported, but not Windows:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;code>Ref&lt;/code>&lt;/th>
&lt;th>Container build inside of the agent with BuildKit&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:azurelinux3-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:bookworm-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:jammy-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:noble-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:ubi8-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:ubi9-main&lt;/code>&lt;/td>
&lt;td>✅&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:win-ltsc2019-main&lt;/code>&lt;/td>
&lt;td>❌&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent:win-ltsc2022-main&lt;/code>&lt;/td>
&lt;td>❌&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4>How to use the bundled BuildKit&lt;span class="hx-absolute -hx-mt-20" id="how-to-use-the-bundled-buildkit">&lt;/span>
&lt;a href="#how-to-use-the-bundled-buildkit" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>There are two components, the backend, &lt;code>buildkitd&lt;/code>, and the CLI, &lt;code>buildctl&lt;/code>.&lt;/p>
&lt;p>Requirements:&lt;/p>
&lt;ul>
&lt;li>Setup special security requirements, you can find them &lt;a href="example/helm/container-build.yaml" >in the example file &lt;code>container-build.yaml&lt;/code>&lt;/a>.&lt;/li>
&lt;li>In the pipeline, run &lt;code>buildkitd&lt;/code> before using &lt;code>buildctl&lt;/code>.&lt;/li>
&lt;/ul>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># azure-pipelines.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">variables&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">container_name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">my-app&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">container_registry_domain&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">my-app-registry.azurecr.io&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">bash&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> # Start buildkitd
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> rootlesskit buildkitd --oci-worker-no-process-sandbox --addr $BUILDKIT_HOST &amp;amp;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> # Wait for buildkitd to start
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> while ! buildctl debug workers; do sleep 1; done&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">displayName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Run BuildKit&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">bash&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> buildctl build \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --frontend dockerfile.v0 \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --local context=. \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --local dockerfile=. \
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> --output type=image,name=$(container_registry_domain)/$(container_name):latest,push=true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">displayName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build and push the image&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Out of the box, argument &lt;code>--opt platform=linux/amd64,linux/arm64&lt;/code> can be added to build an image compatible with multiple architectures (&lt;a href="https://github.com/moby/buildkit/blob/v0.11.5/docs/multi-platform.md" target="_blank" rel="noopener">more can be specified&lt;/a>). Multiple cache strategies &lt;a href="https://github.com/moby/buildkit/tree/v0.11.5#cache" target="_blank" rel="noopener">are available&lt;/a> (including container registry, Azure Storage Blob, AWS S3).&lt;/p>
&lt;h4>BuildKit and the performance&lt;span class="hx-absolute -hx-mt-20" id="buildkit-and-the-performance">&lt;/span>
&lt;a href="#buildkit-and-the-performance" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>BuildKit works by virtualization in the user space. You can&amp;rsquo;t expect build times as short as native (on your laptop for example). &lt;a href="https://www.qemu.org" target="_blank" rel="noopener">QEMU&lt;/a> is used as a backend. This has the advantage of being able to create images for different architectures than your processor. Virtualization-wise, not all CPU models are equivalent, you can &lt;a href="https://www.qemu.org/docs/master/system/qemu-cpu-models.html" target="_blank" rel="noopener">refer to the official project documentation&lt;/a> to select the most appropriated CPU model for your Kubernetes Node Pool.&lt;/p></description></item><item><title>Build Java applications</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/build-java/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/build-java/</guid><description>
&lt;p>Java (JDK and JVM) is not pre-installed into the agents. Specify the specific version you requires for your build. Install the framework with &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/tasks/reference/java-tool-installer-v0?view=azure-pipelines" target="_blank" rel="noopener">JavaToolInstaller@0&lt;/a>, it configures both &lt;code>PATH&lt;/code> and &lt;code>JAVA_HOME&lt;/code> environements variables. The JDK file requires to be placed either in Azure Storage or in a local directory:&lt;/p>
&lt;ul>
&lt;li>Azure Storage (recommended for its audit, replication, and management by API capabilities), downlaod the binary from a central Azure Storage&lt;/li>
&lt;li>Local directory, in the context of a Kubernetes Pod, this directory could be a read-only shared volume mounted in the Pod&lt;/li>
&lt;/ul>
&lt;p>First, create an Azure Storage account and a container named &lt;code>java-temurin&lt;/code>. Then, upload the JDK file to the container. JDK can be downloaded, as example:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://adoptium.net/temurin/releases/?package=jdk&amp;amp;os=linux" target="_blank" rel="noopener">from Eclipse Temurin&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://learn.microsoft.com/en-us/java/openjdk/download" target="_blank" rel="noopener">from Microsoft Build of OpenJDK&lt;/a> (recommended for its support), based on Eclipse Temurin, but with backported fixes and enhancements not yet been formally backported upstream&lt;/li>
&lt;/ul>
&lt;p>Example of an example Azure Storage account named &lt;code>azure-pipelines-bins&lt;/code> and a container &lt;code>java-temurin&lt;/code>, with Eclipse Temurin JDK 17 and 21:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl"># Azure Storage
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/java-temurin (container)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /jdk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OpenJDK21U-jdk_aarch64_linux_hotspot_21.0.1_12.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OpenJDK21U-jdk_x64_linux_hotspot_21.0.1_12.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> OpenJDK17U-jdk_x64_linux_hotspot_17.0.9_9.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [...]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Example of the Azure Pipelines YAML file:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># azure-pipelines.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">task&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">JavaToolInstaller@0&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">inputs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azureCommonVirtualFile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">jdk/21/OpenJDK21U-jdk_x64_linux_hotspot_21.0.1_12.tar&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azureContainerName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">java-temurin&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azureResourceGroupName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AZURE_RESOURCE_GROUP_NAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azureResourceManagerEndpoint&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AZURE_RESOURCE_MANAGER_SERVICE_CONNECTION_NAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">azureStorageAccountName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">azure-pipelines-bins&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jdkArchitectureOption&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">x64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jdkDestinationDirectory&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">$(agent.toolsDirectory)/jdk/21&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jdkSourceOption&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">AzureStorage&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">versionSpec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">21&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div></description></item><item><title>Capabilities</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/capabilities/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/capabilities/</guid><description>
&lt;p>Capabilities are declarative variables you can add to the agents, to allow developers to select the right agent for their pipeline (&lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/demands?view=azure-devops&amp;amp;tabs=yaml" target="_blank" rel="noopener">official documentation&lt;/a>).&lt;/p>
&lt;div class="hx-overflow-x-auto hx-mt-6 hx-flex hx-rounded-lg hx-border hx-py-2 ltr:hx-pr-4 rtl:hx-pl-4 contrast-more:hx-border-current contrast-more:dark:hx-border-current hx-border-blue-200 hx-bg-blue-100 hx-text-blue-900 dark:hx-border-blue-200/30 dark:hx-bg-blue-900/30 dark:hx-text-blue-200">
&lt;div class="ltr:hx-pl-3 ltr:hx-pr-2 rtl:hx-pr-3 rtl:hx-pl-2">&lt;div class="hx-select-none hx-text-xl" style="font-family: 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';">ℹ️&lt;/div>&lt;/div>
&lt;div class="hx-w-full hx-min-w-0 hx-leading-7">
&lt;div class="hx-mt-6 hx-leading-7 first:hx-mt-0">Multiple Helm instances can be deployed using the same agent pool name (see &lt;code>pipelines.poolName&lt;/code>). It will result in a single pool with multiple capabilities. Be warning, if a capability is not unique accross the pool, all the agents will scale. This will create &amp;ldquo;zoombies&amp;rdquo; agents, scaled for nothing, waiting their timeout.&lt;/div>
&lt;/div>
&lt;/div>
&lt;p>Disctinct the agents by capabilities. For examples:&lt;/p>
&lt;ul>
&lt;li>A pool of X64 agents, and a pool of ARM64 agents&lt;/li>
&lt;li>A pool of agents with GPU, and a pool of agents without GPU&lt;/li>
&lt;li>A pool of agents with low performance (standard usage), and a pool of agents with high performance (IA training, intensive C/Rust/GraalVM compilation, &amp;hellip;), with distinct Kubernetes Node pool, scaling to 0 when not used (&lt;a href="https://learn.microsoft.com/en-us/azure/aks/cluster-autoscaler" target="_blank" rel="noopener">AKS documentation&lt;/a>)&lt;/li>
&lt;/ul>
&lt;h4>Example: ARM64 agents&lt;span class="hx-absolute -hx-mt-20" id="example-arm64-agents">&lt;/span>
&lt;a href="#example-arm64-agents" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>Take the assumption we want to host a specific instance pool to ARM servers.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">pipelines&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">poolName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">private_kube&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">capabilities&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_arm64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">extraNodeSelectors&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">kubernetes.io/arch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">arm64&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Deploy the Helm instance:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">❯ helm upgrade --install agent-arm64 clemlesne-blue-agent/blue-agent -f values.yaml&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Update the Azure Pipelines file in the repository to use the new pool:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># azure-pipelines.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">pool&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">private_kube&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">demands&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_arm64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">stages&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">...&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;h4>Example: Use different agents on specific jobs&lt;span class="hx-absolute -hx-mt-20" id="example-use-different-agents-on-specific-jobs">&lt;/span>
&lt;a href="#example-use-different-agents-on-specific-jobs" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>In that example:&lt;/p>
&lt;ul>
&lt;li>We are using a default agent on ARM64&lt;/li>
&lt;li>Semgrep, our SAST tool, is not compatible with ARM64, let&amp;rsquo;s use X64 pool&lt;/li>
&lt;li>Our devs are working on a Java project, built with GraalVM, and the container is built locally with BuildKit: we need a system lot of RAM and multipe CPUs for building the application&lt;/li>
&lt;/ul>
&lt;p>Our problematic:&lt;/p>
&lt;ul>
&lt;li>Is it possible to reconcile the efficiency of these different architectures, without restricting ourselves?&lt;/li>
&lt;li>Do we necessarily have to install high performance agents when the use of these large constructions is only a small part of the total execution time (tests, deployments, monitoring, rollback, external services, &amp;hellip;)?&lt;/li>
&lt;/ul>
&lt;p>We decide to dpeloy these agents:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Details&lt;/th>
&lt;th>Efficiency (cost, perf, energy)&lt;/th>
&lt;th>Capabilities&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Standard performance, ARM64&lt;/td>
&lt;td>≅ x1&lt;/td>
&lt;td>&lt;code>arch_arm64&lt;/code>, &lt;code>perf_standard&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Standard performance, X64&lt;/td>
&lt;td>≅ x1.5&lt;/td>
&lt;td>&lt;code>arch_x64&lt;/code>, &lt;code>perf_standard&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>High performance, ARM64&lt;/td>
&lt;td>≅ x10&lt;/td>
&lt;td>&lt;code>arch_x64&lt;/code>, &lt;code>perf_high&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>High performance, X64&lt;/td>
&lt;td>≅ x15&lt;/td>
&lt;td>&lt;code>arch_arm64&lt;/code>, &lt;code>perf_high&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>The developer can now use:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># azure-pipelines.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">pool&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">private_kube&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">demands&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_arm64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">perf_standard&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">stages&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">stage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">build&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">sast&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Use X64 Linux agent because Semgrep is not available on ARM64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># See: https://github.com/returntocorp/semgrep/issues/2252&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pool&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">private_kube&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">demands&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_x64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">perf_standard&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unit_tests&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">container&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># Use high performance agent as Java GraalVM compilation is complex&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pool&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">private_kube&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">demands&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">arch_x64&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">perf_high&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">stage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">upgrade&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">dast&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">integration_tests&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div></description></item><item><title>Custom root certificate</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/ca-certificate/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/ca-certificate/</guid><description>
&lt;p>If you need to run the agent with a custom root certificate, you can use the following Helm values. Format is &lt;a href="https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail" target="_blank" rel="noopener">PEM certificate&lt;/a> and with &lt;a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8&lt;/a> encoding.&lt;/p>
&lt;p>Paths are &lt;code>/app-root/azp-custom-certs&lt;/code> for Linux-based agents and &lt;code>C:\app-root\azp-custom-certs&lt;/code> for Windows-based agents.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># config-root-ca.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ConfigMap&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">custom-certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">data&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">root-1.crt&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -----BEGIN CERTIFICATE-----
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -----END CERTIFICATE-----&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">root-2.crt&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -----BEGIN CERTIFICATE-----
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> ...
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> -----END CERTIFICATE-----&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">extraVolumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">custom-certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">configMap&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">custom-certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">extraVolumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">custom-certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/app-root/azp-custom-certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">readOnly&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div></description></item><item><title>Deploy on Azure with Bicep</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/bicep-deployment/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/bicep-deployment/</guid><description>
&lt;p>Bicep is a deployment language for Azure, allowing to easily deploy resources on the cloud.&lt;/p>
&lt;h4>Bicep parameters&lt;span class="hx-absolute -hx-mt-20" id="bicep-parameters">&lt;/span>
&lt;a href="#bicep-parameters" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Parameter&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Default&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>autoscalingMaxReplicas&lt;/code>&lt;/td>
&lt;td>Maximum number of simultaneous jobs the agent can run&lt;/td>
&lt;td>&lt;code>100&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscalingMinReplicas&lt;/code>&lt;/td>
&lt;td>Minimum number of replicas the agent should have&lt;/td>
&lt;td>&lt;code>0&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscalingPollingInterval&lt;/code>&lt;/td>
&lt;td>Minimum number of replicas the agent should have; Warning, a low value will cause rate limiting or throttling, and can cause high load on the Azure DevOps API&lt;/td>
&lt;td>&lt;code>10&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>extraEnv&lt;/code>&lt;/td>
&lt;td>Extra environment variables to pass to the agent&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>imageFlavor&lt;/code>&lt;/td>
&lt;td>Flavor of the container image, represents the Linux distribution. Allowed values: &lt;code>azurelinux3&lt;/code>, &lt;code>bookworm&lt;/code>, &lt;code>jammy&lt;/code>, &lt;code>noble&lt;/code>, &lt;code>ubi8&lt;/code>, &lt;code>ubi9&lt;/code>&lt;/td>
&lt;td>&lt;code>bookworm&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>imageName&lt;/code>&lt;/td>
&lt;td>Name of the container image&lt;/td>
&lt;td>&lt;code>clemlesne/blue-agent&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>imageRegistry&lt;/code>&lt;/td>
&lt;td>Registry of the container image. Allowed values: &lt;code>docker.io&lt;/code>, &lt;code>ghcr.io&lt;/code>&lt;/td>
&lt;td>&lt;code>ghcr.io&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>imageVersion&lt;/code>&lt;/td>
&lt;td>Version of the container image, it is recommended to use a specific version like &amp;ldquo;1.0.0&amp;rdquo; instead of &amp;ldquo;latest&amp;rdquo;&lt;/td>
&lt;td>&lt;code>main&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>instance&lt;/code>&lt;/td>
&lt;td>Name of the instance, will be used to build the name of the resources&lt;/td>
&lt;td>Value from &lt;code>deployment().name&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>location&lt;/code>&lt;/td>
&lt;td>Location of resources&lt;/td>
&lt;td>&lt;code>westeurope&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelinesCapabilities&lt;/code>&lt;/td>
&lt;td>Capabilities of the agent&lt;/td>
&lt;td>&lt;code>['arch_x64']&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelinesOrganizationURL&lt;/code>&lt;/td>
&lt;td>URL of the Azure DevOps organization&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelinesPersonalAccessToken&lt;/code>&lt;/td>
&lt;td>Personal access token allowing the agent to connect to the Azure DevOps organization. This parameter is secure.&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelinesPoolName&lt;/code>&lt;/td>
&lt;td>Name of the Azure Pipelines self-hosted pool the agent should be added to&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelinesTimeout&lt;/code>&lt;/td>
&lt;td>Timeout in seconds for the agent to run a job before it is automatically terminated&lt;/td>
&lt;td>&lt;code>3600&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>resourcesCpu&lt;/code>&lt;/td>
&lt;td>Number of CPU cores allocated to the agent&lt;/td>
&lt;td>&lt;code>2&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>resourcesMemory&lt;/code>&lt;/td>
&lt;td>Amount of memory allocated to the agent&lt;/td>
&lt;td>&lt;code>4Gi&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Deploy on Kubernetes with Helm</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/helm-deployment/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/helm-deployment/</guid><description>
&lt;p>Helm is a package manager for Kubernetes, allowing to easily deploy applications on a cluster.&lt;/p>
&lt;h4>Helm values&lt;span class="hx-absolute -hx-mt-20" id="helm-values">&lt;/span>
&lt;a href="#helm-values" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Parameter&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Default&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>affinity&lt;/code>&lt;/td>
&lt;td>Node affinity for pod assignment&lt;/td>
&lt;td>&lt;code>{}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>annotations&lt;/code>&lt;/td>
&lt;td>Add custom annotations to the Pod&lt;/td>
&lt;td>&lt;code>{}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscaling.cooldown&lt;/code>&lt;/td>
&lt;td>Time in seconds the automation will wait until there is no more pipeline asking for an agent; same delay is then applied for system termination&lt;/td>
&lt;td>&lt;code>60&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscaling.enabled&lt;/code>&lt;/td>
&lt;td>Enable the auto-scaling; requires &lt;a href="https://keda.sh" target="_blank" rel="noopener">KEDA&lt;/a>, but can be started without; Be warning, disabling auto-scaling implies a shutdown of the existing agents during a Helm instance upgrade, according to &lt;code>pipelines.timeout&lt;/code>&lt;/td>
&lt;td>&lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscaling.minReplicas&lt;/code>&lt;/td>
&lt;td>Minimum number of replicas&lt;/td>
&lt;td>&lt;code>0&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscaling.maxReplicas&lt;/code>&lt;/td>
&lt;td>Maximum number of pods, remaining jobs will be kept in queue; the default value is arbitrary, to avoid misconfiguration&lt;/td>
&lt;td>&lt;code>100&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>autoscaling.pollingInterval&lt;/code>&lt;/td>
&lt;td>Interval in seconds to poll for new jobs; Warning, a low value will cause rate limiting or throttling, and can cause high load on the Azure DevOps API&lt;/td>
&lt;td>&lt;code>10&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>extraEnv&lt;/code>&lt;/td>
&lt;td>Additional environment variables for the agent container&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>extraManifests&lt;/code>&lt;/td>
&lt;td>Extra manifests to deploy as an array&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>extraNodeSelectors&lt;/code>&lt;/td>
&lt;td>Additional node labels for pod assignment&lt;/td>
&lt;td>&lt;code>{}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>extraVolumeMounts&lt;/code>&lt;/td>
&lt;td>Additional volume mounts for the agent container&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>extraVolumes&lt;/code>&lt;/td>
&lt;td>Additional volumes for the agent pod&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fullnameOverride&lt;/code>&lt;/td>
&lt;td>Overrides release fullname&lt;/td>
&lt;td>&lt;code>&amp;quot;&amp;quot;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>image.flavor&lt;/code>&lt;/td>
&lt;td>Container image tag, can be &lt;code>bookworm&lt;/code>, &lt;code>jammy&lt;/code>, &lt;code>noble&lt;/code>, &lt;code>ubi8&lt;/code>, &lt;code>ubi9&lt;/code>, &lt;code>win-ltsc2019&lt;/code>, or &lt;code>win-ltsc2022&lt;/code>&lt;/td>
&lt;td>&lt;code>bookworm&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>image.isWindows&lt;/code>&lt;/td>
&lt;td>Turn on is the agent is a Windows-based system&lt;/td>
&lt;td>&lt;code>false&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>image.pullPolicy&lt;/code>&lt;/td>
&lt;td>Container image pull policy&lt;/td>
&lt;td>&lt;code>IfNotPresent&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>image.repository&lt;/code>&lt;/td>
&lt;td>Container image repository&lt;/td>
&lt;td>&lt;code>ghcr.io/clemlesne/blue-agent&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>image.version&lt;/code>&lt;/td>
&lt;td>Container image tag&lt;/td>
&lt;td>&lt;em>Version&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>imagePullSecrets&lt;/code>&lt;/td>
&lt;td>Use secrets to pull the container image&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>initContainers&lt;/code>&lt;/td>
&lt;td>Init containers for the agent pod&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>nameOverride&lt;/code>&lt;/td>
&lt;td>Overrides release name&lt;/td>
&lt;td>&lt;code>&amp;quot;&amp;quot;&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.cache.size&lt;/code>&lt;/td>
&lt;td>Total cache to attach to the Azure Pipelines standard directory; by default, &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&amp;amp;tabs=yaml#hardware" target="_blank" rel="noopener">same amount as the Microsoft Hosted agents&lt;/a>&lt;/td>
&lt;td>&lt;code>10Gi&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.cache.type&lt;/code>&lt;/td>
&lt;td>Disk type to attach to the Azure Pipelines standard directory; see your cloud provider for types (&lt;a href="https://learn.microsoft.com/en-us/azure/aks/concepts-storage#storage-classes" target="_blank" rel="noopener">Azure&lt;/a>, &lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/storage-classes.html" target="_blank" rel="noopener">AWS&lt;/a>)&lt;/td>
&lt;td>&lt;code>managed-csi&lt;/code> (Azure compatible)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.cache.volumeEnabled&lt;/code>&lt;/td>
&lt;td>Enabled by default, can be disabled if your CSI driver doesn&amp;rsquo;t support ephemeral storage (&lt;a href="https://kubernetes-csi.github.io/docs/drivers.html" target="_blank" rel="noopener">exhaustive list&lt;/a>); if disabled, it is advised to allow &amp;gt;= 10Gi of ephemeral storage usage (see &lt;code>resources&lt;/code>)&lt;/td>
&lt;td>&lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.capabilities&lt;/code>&lt;/td>
&lt;td>Add &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/process/demands?view=azure-devops&amp;amp;tabs=yaml" target="_blank" rel="noopener">demands/capabilities&lt;/a> to the agent&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.cleanup.failed&lt;/code>&lt;/td>
&lt;td>Maximum of failed Jobs to keep from Kubernetes API server (&lt;a href="https://keda.sh/docs/2.11/concepts/scaling-jobs/#scaledjob-spec" target="_blank" rel="noopener">see doc&lt;/a>); only applied to autoscaled deployments (see &lt;code>autoscaling.enabled&lt;/code>)&lt;/td>
&lt;td>&lt;code>100&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.cleanup.successful&lt;/code>&lt;/td>
&lt;td>Maximum of successful Jobs to keep from Kubernetes API server (&lt;a href="https://keda.sh/docs/2.11/concepts/scaling-jobs/#scaledjob-spec" target="_blank" rel="noopener">see doc&lt;/a>); only applied to autoscaled deployments (see &lt;code>autoscaling.enabled&lt;/code>)&lt;/td>
&lt;td>&lt;code>100&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.cleanup.ttl&lt;/code>&lt;/td>
&lt;td>Delay until Job history will be cleaned from Kubernetes API server (&lt;a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/#ttl-mechanism-for-finished-jobs" target="_blank" rel="noopener">see doc&lt;/a>); only applied to autoscaled deployments (see &lt;code>autoscaling.enabled&lt;/code>)&lt;/td>
&lt;td>&lt;code>3600&lt;/code> (1 hour)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.organizationURL&lt;/code>&lt;/td>
&lt;td>The Azure base URL for your organization&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.personalAccessToken&lt;/code>&lt;/td>
&lt;td>Personal Access Token (PAT) used by the agent to connect to the Azure DevOps server (both SaaS and self-hosted)&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.poolName&lt;/code>&lt;/td>
&lt;td>Agent pool name to which the agent should register&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.timeout&lt;/code>&lt;/td>
&lt;td>Time in seconds after a agent will be stopped, the same amount of time is applied as a timeout for the system to shut down&lt;/td>
&lt;td>&lt;code>3600&lt;/code> (1 hour)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.tmpdir.size&lt;/code>&lt;/td>
&lt;td>Total size of the &lt;a href="https://en.wikipedia.org/wiki/TMPDIR" target="_blank" rel="noopener">standard &lt;code>TMPDIR&lt;/code> directory&lt;/a>&lt;/td>
&lt;td>&lt;code>1Gi&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.tmpdir.type&lt;/code>&lt;/td>
&lt;td>Disk type to attach to the &lt;a href="https://en.wikipedia.org/wiki/TMPDIR" target="_blank" rel="noopener">standard &lt;code>TMPDIR&lt;/code> directory&lt;/a>; see your cloud provider for types (&lt;a href="https://learn.microsoft.com/en-us/azure/aks/concepts-storage#storage-classes" target="_blank" rel="noopener">Azure&lt;/a>, &lt;a href="https://docs.aws.amazon.com/eks/latest/userguide/storage-classes.html" target="_blank" rel="noopener">AWS&lt;/a>)&lt;/td>
&lt;td>&lt;code>managed-csi&lt;/code> (Azure compatible)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>pipelines.tmpdir.volumeEnabled&lt;/code>&lt;/td>
&lt;td>Enabled by default, can be disabled if your CSI driver doesn&amp;rsquo;t support ephemeral storage (&lt;a href="https://kubernetes-csi.github.io/docs/drivers.html" target="_blank" rel="noopener">exhaustive list&lt;/a>); if disabled, it is advised to allow &amp;gt;= 10Gi of ephemeral storage usage (see &lt;code>resources&lt;/code>)&lt;/td>
&lt;td>&lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>podSecurityContext&lt;/code>&lt;/td>
&lt;td>Security rules applied to the Pod (&lt;a href="https://kubernetes.io/docs/concepts/security/pod-security-standards" target="_blank" rel="noopener">more details&lt;/a>)&lt;/td>
&lt;td>&lt;code>{}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>replicaCount&lt;/code>&lt;/td>
&lt;td>Default fixed amount of agents deployed; those are not auto-scaled&lt;/td>
&lt;td>&lt;code>3&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>resources&lt;/code>&lt;/td>
&lt;td>Resource limits&lt;/td>
&lt;td>&lt;code>{ &amp;quot;resources&amp;quot;: { &amp;quot;limits&amp;quot;: { &amp;quot;cpu&amp;quot;: 2, &amp;quot;memory&amp;quot;: &amp;quot;4Gi&amp;quot;, &amp;quot;ephemeral-storage&amp;quot;: &amp;quot;8Gi&amp;quot; }, &amp;quot;requests&amp;quot;: { &amp;quot;cpu&amp;quot;: 1, &amp;quot;memory&amp;quot;: &amp;quot;2Gi&amp;quot;, &amp;quot;ephemeral-storage&amp;quot;: &amp;quot;2Gi&amp;quot; }}}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>revisionHistoryLimit&lt;/code>&lt;/td>
&lt;td>Number of revisions to keep in the history of the Deployment&lt;/td>
&lt;td>&lt;code>10&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>secret.create&lt;/code>&lt;/td>
&lt;td>Indicates if the secret should be managed by the chart&lt;/td>
&lt;td>&lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>secret.name&lt;/code>&lt;/td>
&lt;td>Secret name&lt;/td>
&lt;td>&lt;em>Release name&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>secret.azureKeyVault.enabled&lt;/code>&lt;/td>
&lt;td>Indicates if the secret should be synced from Azure Key Vault with pod-managed identities (&lt;a href="https://learn.microsoft.com/en-us/azure/aks/use-azure-ad-pod-identity" target="_blank" rel="noopener">more details&lt;/a>)&lt;/td>
&lt;td>&lt;code>false&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>secret.azureKeyVault.managedIdentityId&lt;/code>&lt;/td>
&lt;td>ID of the Entra ID managed identity&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>secret.azureKeyVault.name&lt;/code>&lt;/td>
&lt;td>Name of the Azure Key Vault resource&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>secret.azureKeyVault.tenantId&lt;/code>&lt;/td>
&lt;td>Tenant ID of the Azure Key Vault resource&lt;/td>
&lt;td>&lt;em>None&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>securityContext&lt;/code>&lt;/td>
&lt;td>Security rules applied to the container (&lt;a href="https://kubernetes.io/docs/concepts/security/pod-security-standards" target="_blank" rel="noopener">more details&lt;/a>)&lt;/td>
&lt;td>&lt;code>{}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>serviceAccount.annotations&lt;/code>&lt;/td>
&lt;td>Custom annotations to give to the ServiceAccount&lt;/td>
&lt;td>&lt;code>{}&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>serviceAccount.create&lt;/code>&lt;/td>
&lt;td>Create ServiceAccount&lt;/td>
&lt;td>&lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>serviceAccount.name&lt;/code>&lt;/td>
&lt;td>ServiceAccount name&lt;/td>
&lt;td>&lt;em>Release name&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>sidecarContainers&lt;/code>&lt;/td>
&lt;td>Containers to run alongside the agent container&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>tolerations&lt;/code>&lt;/td>
&lt;td>Toleration labels for pod assignment&lt;/td>
&lt;td>&lt;code>[]&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Performance</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/performance/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/performance/</guid><description>
&lt;p>These actions can enhance your system performance:&lt;/p>
&lt;ul>
&lt;li>Enough CPU and memory are allocated to the agent (see &lt;code>resources&lt;/code>). See the your Kubernetes monitoring software to detect bottlenecks (notably CPU, RAM, IOPS, network, disk size).&lt;/li>
&lt;li>No &lt;code>emptyDir&lt;/code> is used (see &lt;code>pipelines.cache.volumeEnabled&lt;/code>, &lt;code>pipelines.tmpdir.volumeEnabled&lt;/code>, and &lt;code>extraVolumes&lt;/code>).&lt;/li>
&lt;li>SSD volumes are used for both cache (see &lt;code>pipelines.cache&lt;/code>) and system temporary directory (see &lt;code>pipelines.tmpdir&lt;/code>). For exemple, in Azure, the &lt;code>managed-csi-premium&lt;/code> volume type is a high-performance SSD.&lt;/li>
&lt;li>The network bewteen Azure DevOps server and agents has a low latency.&lt;/li>
&lt;/ul>
&lt;p>BuikdKit specifics:&lt;/p>
&lt;ul>
&lt;li>Choose an ephemeral disk for the cache in &lt;code>/app-root/.local/share/buildkit&lt;/code>, instead of an emptyDir.&lt;/li>
&lt;li>Use an high-performance disk for the cache, exemple &lt;code>managed-csi-premium&lt;/code> in Azure.&lt;/li>
&lt;/ul></description></item><item><title>Pricing</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/pricing/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/pricing/</guid><description>
&lt;p>Blue Agent packages infrastructure as code ready to be deployed on two stacks, Kubernetes and Azure Container Apps.&lt;/p>
&lt;h4>Kubernetes&lt;span class="hx-absolute -hx-mt-20" id="kubernetes">&lt;/span>
&lt;a href="#kubernetes" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>Costs of a Kubernetes cluster vary a lot depending of your provider, region, and the resources you need.&lt;/p>
&lt;p>For precise cost reports, you can use &lt;a href="https://github.com/opencost/opencost" target="_blank" rel="noopener">OpenCost&lt;/a>, or &lt;a href="https://learn.microsoft.com/en-us/azure/aks/cost-analysis" target="_blank" rel="noopener">Azure Kubernetes Service cost analysis addon&lt;/a>. The AKS cost analysis addon is based on OpenCost.&lt;/p>
&lt;h4>Azure Container Apps&lt;span class="hx-absolute -hx-mt-20" id="azure-container-apps">&lt;/span>
&lt;a href="#azure-container-apps" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;p>As of Oct 22, 2024, Azure Container Apps pricing is as follows:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Meter&lt;/th>
&lt;th>Pay as you go Price*&lt;/th>
&lt;th>1-year Savings Plan Price*&lt;/th>
&lt;th>3-year Savings Plan Price*&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>vCPU (seconds)&lt;/td>
&lt;td>$0.000024 /sec&lt;/td>
&lt;td>$0.0000204 /sec&lt;br>~15% savings&lt;/td>
&lt;td>$0.00001992 /sec&lt;br>~17% savings&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Memory (GiB-Seconds)&lt;/td>
&lt;td>$0.000003 /sec&lt;/td>
&lt;td>$0.00000255 /sec&lt;br>~15% savings&lt;/td>
&lt;td>$0.00000249 /sec&lt;br>~17% savings&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>As agents are scaled down to zero when not in use, the cost is calculated based on the time the agent is running. Default deployment is 2 vCPUs and 4GiB of memory.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">= ([vCPU cost] * 2 + [Memory cost] * 4) * [Time in seconds]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">= (0.000024 * 2 + 0.000003 * 4) * [Time in seconds]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">= 0.00006 * [Time in seconds]&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div>
&lt;p>Thus, cost per hour is:&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-txt" data-lang="txt">&lt;span class="line">&lt;span class="cl">= 0.00006 * 3600
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">= $0.216&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div></description></item><item><title>Provided software</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/provided-software/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/provided-software/</guid><description>
&lt;p>Softwares are operating system specific. The following table lists the softwares provided by the agent.&lt;/p>
&lt;h4>Linux&lt;span class="hx-absolute -hx-mt-20" id="linux">&lt;/span>
&lt;a href="#linux" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;a href="https://github.com/microsoft/azure-pipelines-agent" target="_blank" rel="noopener">Azure Pipelines agent&lt;/a> + &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/docker?view=azure-devops#linux" target="_blank" rel="noopener">requirements&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/moby/buildkit" target="_blank" rel="noopener">BuildKit&lt;/a> + requirements (&lt;a href="https://dbus.freedesktop.org" target="_blank" rel="noopener">dbus-user-session&lt;/a>, &lt;a href="https://github.com/containers/fuse-overlayfs" target="_blank" rel="noopener">fuse-overlayfs&lt;/a>, &lt;a href="https://www.netfilter.org/projects/iptables/index.html" target="_blank" rel="noopener">iptables&lt;/a>, &lt;a href="https://github.com/shadow-maint/shadow" target="_blank" rel="noopener">shadow-utils&lt;/a>, &lt;a href="https://github.com/shadow-maint/shadow" target="_blank" rel="noopener">uidmap&lt;/a>)&lt;/li>
&lt;li>Cloud providers CLIs
&lt;ul>
&lt;li>&lt;a href="https://github.com/aws/aws-cli" target="_blank" rel="noopener">AWS CLI&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/Azure/azure-cli" target="_blank" rel="noopener">Azure CLI&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/sdk" target="_blank" rel="noopener">Google Cloud SDK&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Shells
&lt;ul>
&lt;li>&lt;a href="https://www.gnu.org/software/bash" target="_blank" rel="noopener">bash&lt;/a> (default)&lt;/li>
&lt;li>&lt;a href="https://github.com/PowerShell/PowerShell" target="_blank" rel="noopener">PowerShell Core&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.zsh.org" target="_blank" rel="noopener">zsh&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Programming languages
&lt;ul>
&lt;li>&lt;a href="https://github.com/dotnet/aspnetcore" target="_blank" rel="noopener">ASP.NET Core Runtime&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.python.org/3/whatsnew/3.12.html" target="_blank" rel="noopener">Python 3.12&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Tools
&lt;ul>
&lt;li>&lt;a href="https://www.isc.org/bind" target="_blank" rel="noopener">dnsutils&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/git-for-windows/git" target="_blank" rel="noopener">git&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.gnu.org/software/gzip" target="_blank" rel="noopener">gzip&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/stedolan/jq" target="_blank" rel="noopener">jq&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.gnu.org/software/make" target="_blank" rel="noopener">make&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.openssl.org" target="_blank" rel="noopener">openssl&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://rsync.samba.org" target="_blank" rel="noopener">rsync&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.gnu.org/software/tar" target="_blank" rel="noopener">tar&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://infozip.sourceforge.net/UnZip.html" target="_blank" rel="noopener">unzip&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://www.gnu.org/software/wget" target="_blank" rel="noopener">wget&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/mikefarah/yq" target="_blank" rel="noopener">yq&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://infozip.sourceforge.net/Zip.html" target="_blank" rel="noopener">zip&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/facebook/zstd" target="_blank" rel="noopener">zstd&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4>Windows&lt;span class="hx-absolute -hx-mt-20" id="windows">&lt;/span>
&lt;a href="#windows" class="subheading-anchor" aria-label="Permalink for this section">&lt;/a>&lt;/h4>&lt;ul>
&lt;li>&lt;a href="https://github.com/microsoft/azure-pipelines-agent" target="_blank" rel="noopener">Azure Pipelines agent&lt;/a> + &lt;a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/agents/docker?view=azure-devops#linux" target="_blank" rel="noopener">requirements&lt;/a>&lt;/li>
&lt;li>Cloud providers CLIs
&lt;ul>
&lt;li>&lt;a href="https://github.com/aws/aws-cli" target="_blank" rel="noopener">AWS CLI&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/Azure/azure-cli" target="_blank" rel="noopener">Azure CLI&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://cloud.google.com/sdk" target="_blank" rel="noopener">Google Cloud SDK&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Shells
&lt;ul>
&lt;li>&lt;a href="https://github.com/PowerShell/PowerShell" target="_blank" rel="noopener">PowerShell Core&lt;/a> (default)&lt;/li>
&lt;li>&lt;a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/install/installing-windows-powershell?view=powershell-7.3" target="_blank" rel="noopener">Windows PowerShell&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Programming languages
&lt;ul>
&lt;li>&lt;a href="https://dotnet.microsoft.com" target="_blank" rel="noopener">.NET SDK&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.python.org/3/whatsnew/3.12.html" target="_blank" rel="noopener">Python 3.12&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://learn.microsoft.com/en-us/visualstudio/ide/?view=vs-2022" target="_blank" rel="noopener">Visual Studio Build Tools (LTSC 17.12)&lt;/a> (with &lt;code>AzureBuildTools&lt;/code>, &lt;code>VCTools&lt;/code>, &lt;code>WebBuildTools&lt;/code>, &lt;code>ManagedDesktopBuildTools&lt;/code>, &lt;code>OfficeBuildTools&lt;/code> workloads)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Tools
&lt;ul>
&lt;li>&lt;a href="https://github.com/git-for-windows/git" target="_blank" rel="noopener">git&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/stedolan/jq" target="_blank" rel="noopener">jq&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/mikefarah/yq" target="_blank" rel="noopener">yq&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/facebook/zstd" target="_blank" rel="noopener">zstd&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Proxy</title><link>https://clemlesne.github.io/blue-agent/docs/advanced-topics/proxy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://clemlesne.github.io/blue-agent/docs/advanced-topics/proxy/</guid><description>
&lt;p>If you need to use a proxy, you can set the following environment variables. See &lt;a href="https://github.com/microsoft/blue-agent/blob/master/docs/start/proxyconfig.md" target="_blank" rel="noopener">this documentation&lt;/a> for more details.&lt;/p>
&lt;div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
&lt;div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># values.yaml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">extraEnv&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">VSTS_HTTP_PROXY&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">http://proxy:8080&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">VSTS_HTTP_PROXY_USERNAME&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">username&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">VSTS_HTTP_PROXY_PASSWORD&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">value&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">password&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/div>&lt;div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
&lt;button
class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
title="Copy code"
>
&lt;div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4">&lt;/div>
&lt;/button>
&lt;/div>
&lt;/div></description></item></channel></rss>